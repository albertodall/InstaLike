@using InstaLike.Web.Extensions

@model PostModel

@{
    var liked = Model.UserLikes.Any(user => user == User.Identity.Name);
}

<div>
    <div class="author">
        @{
            var profilePictureBase64 = Convert.ToBase64String(Model.AuthorProfilePicture);
            var profilePicture = String.Format("data:image/jpeg;base64,{0}", profilePictureBase64);
        }
        <img src="@profilePicture" />

        <a href="@Url.Action("Profile", "Account", new { @id = Model.AuthorNickName })">
            @Model.AuthorNickName
        </a>

        <time title="@Model.PostDate.DateTime.ToString("dd/MM/yyyy HH:mm")" datetime="@Model.PostDate.DateTime.ToString("dd/MM/yyyy HH:mm")">
            @Model.PostDate.UtcDateTime.AsPastDays()
        </time>
    </div>

    <a href="@Url.Action("Detail", "Post", new { id = Model.PostID })">
        @{
            var postPictureBase64 = Convert.ToBase64String(Model.Picture);
            var postPicture = String.Format("data:image/jpeg;base64,{0}", postPictureBase64);
        }
        <img class="image-timeline" src="@postPicture" />
    </a>

    <div>
        <div class="post-likes">
            <button class="pulsante-like @(liked ? "post-piaciuto" : String.Empty)" data-post-id="@Model.PostID">
                Like
            </button>
            <strong>
                <span class="numero-like">@Model.UserLikes.Count()</span> likes
            </strong>
        </div>

        <p class="commento-autore-post">
            @Html.Raw(Model.Text)
        </p>

        <partial name="~/Views/Post/_CommentsPartial.cshtml" model="Model.Comments" />

        <partial name="~/Views/Post/_AddCommentPartial.cshtml" model="Model" />
    </div>
</div>